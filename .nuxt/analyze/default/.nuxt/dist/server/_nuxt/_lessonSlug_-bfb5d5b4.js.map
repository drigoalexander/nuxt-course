{"version":3,"file":"_lessonSlug_-bfb5d5b4.js","sources":["../../../../../../../components/VideoPlayer.vue","../../../../../../../node_modules/nuxt/dist/app/components/client-only.js","../../../../../../../composables/useLesson.ts","../../../../../../../store/courseProgress.ts","../../../../../../../pages/course/chapter/[chapterSession]/lesson/[lessonSlug].vue"],"sourcesContent":["<script lang=\"ts\" setup>\nconst props = defineProps({\n  videoID: {\n    type: Number,\n    required: true,\n  },\n});\n</script>\n\n<template>\n  <iframe\n    :src=\"`https://player.vimeo.com/video/${props.videoID}`\"\n    width=\"100%\"\n    height=\"100%\"\n    frameborder=\"0\"\n    title=\"{video_title}\"\n    webkitallowfullscreen\n    mozallowfullscreen\n    allowfullscreen\n  ></iframe>\n</template>\n\n<style scoped></style>\n","import { createElementBlock, createElementVNode, createStaticVNode, defineComponent, getCurrentInstance, h, onMounted, ref } from \"vue\";\nimport { getFragmentHTML } from \"./utils.js\";\nexport default defineComponent({\n  name: \"ClientOnly\",\n  inheritAttrs: false,\n  // eslint-disable-next-line vue/require-prop-types\n  props: [\"fallback\", \"placeholder\", \"placeholderTag\", \"fallbackTag\"],\n  setup(_, { slots, attrs }) {\n    const mounted = ref(false);\n    onMounted(() => {\n      mounted.value = true;\n    });\n    return (props) => {\n      if (mounted.value) {\n        return slots.default?.();\n      }\n      const slot = slots.fallback || slots.placeholder;\n      if (slot) {\n        return slot();\n      }\n      const fallbackStr = props.fallback || props.placeholder || \"\";\n      const fallbackTag = props.fallbackTag || props.placeholderTag || \"span\";\n      return createElementBlock(fallbackTag, attrs, fallbackStr);\n    };\n  }\n});\nconst cache = /* @__PURE__ */ new WeakMap();\n/*! @__NO_SIDE_EFFECTS__ */\n// @__NO_SIDE_EFFECTS__\nexport function createClientOnly(component) {\n  if (cache.has(component)) {\n    return cache.get(component);\n  }\n  const clone = { ...component };\n  if (clone.render) {\n    clone.render = (ctx, ...args) => {\n      if (ctx.mounted$) {\n        const res = component.render?.bind(ctx)(ctx, ...args);\n        return res.children === null || typeof res.children === \"string\" ? createElementVNode(res.type, res.props, res.children, res.patchFlag, res.dynamicProps, res.shapeFlag) : h(res);\n      } else {\n        const fragment = getFragmentHTML(ctx._.vnode.el ?? null);\n        return process.client ? createStaticVNode(fragment.join(\"\"), fragment.length) : h(\"div\", ctx.$attrs ?? ctx._.attrs);\n      }\n    };\n  } else if (clone.template) {\n    clone.template = `\n      <template v-if=\"mounted$\">${component.template}</template>\n      <template v-else><div></div></template>\n    `;\n  }\n  clone.setup = (props, ctx) => {\n    const instance = getCurrentInstance();\n    const attrs = instance.attrs;\n    const directives = extractDirectives(instance);\n    instance.attrs = {};\n    const mounted$ = ref(false);\n    onMounted(() => {\n      instance.attrs = attrs;\n      instance.vnode.dirs = directives;\n      mounted$.value = true;\n    });\n    return Promise.resolve(component.setup?.(props, ctx) || {}).then((setupState) => {\n      return typeof setupState !== \"function\" ? { ...setupState, mounted$ } : (...args) => {\n        if (mounted$.value) {\n          const res = setupState(...args);\n          return res.children === null || typeof res.children === \"string\" ? createElementVNode(res.type, res.props, res.children, res.patchFlag, res.dynamicProps, res.shapeFlag) : h(res);\n        } else {\n          const fragment = getFragmentHTML(instance?.vnode.el ?? null);\n          return process.client ? createStaticVNode(fragment.join(\"\"), fragment.length) : h(\"div\", ctx.attrs);\n        }\n      };\n    });\n  };\n  cache.set(component, clone);\n  return clone;\n}\nfunction extractDirectives(instance) {\n  if (!instance || !instance.vnode.dirs) {\n    return null;\n  }\n  const directives = instance.vnode.dirs;\n  instance.vnode.dirs = null;\n  return directives;\n}\n","export default async (chapterSlug: string, lessonSlug: string) => {\n  const url = `/api/course/chapter/${chapterSlug}/lesson/${lessonSlug}`;\n  return await useLessonWithCache(url);\n};\n","import { defineStore } from \"pinia\";\n\nexport const useCourseProgress = defineStore(\"courseProgress\", () => {\n  const user = useSupabaseUser();\n  const progress = ref<any>({});\n  const initialized = ref(false);\n\n  async function initialize() {\n    if (initialized.value) return;\n    initialized.value = true;\n  }\n  const toggleComplete = async (chapter: string, lesson: string) => {\n    const user = useSupabaseUser();\n    if (!user.value) return;\n    if (!chapter || !lesson) {\n      const {\n        params: { chapterSession, lessonSlug },\n      } = useRoute();\n      chapter = chapterSession as string;\n      lesson = lessonSlug as string;\n    }\n    const currentProgress = progress.value[chapter]?.[lesson];\n    progress.value[chapter] = {\n      ...progress.value[chapter],\n      [lesson]: !currentProgress,\n    };\n    try {\n      await $fetch(`/api/course/chapter/${chapter}/lesson/${lesson}/progress`, {\n        method: \"POST\",\n        body: {\n          completed: !currentProgress,\n          userEmail: user.value.email,\n        },\n      });\n    } catch (error) {\n      console.error(error);\n      progress.value[chapter] = {\n        ...progress.value[chapter],\n        [lesson]: currentProgress,\n      };\n    }\n  };\n\n  return {\n    initialize,\n    progress,\n    toggleComplete,\n  };\n});\n","<template>\n  <div class=\"w-3/4 mx-auto h-3/4 my-auto gap-6 flex flex-col\">\n    <h4 class=\"text-xl font-semibold\">\n      Chapter {{ currentChapter.number }} - Lesson {{ lesson.data.number }}\n    </h4>\n    <h1 class=\"text-4xl font-bold\">{{ lesson.data.title }}</h1>\n\n    <VideoPlayer :videoID=\"lesson.data.videoId\" />\n\n    <p>{{ lesson.data.text }}</p>\n    <ClientOnly>\n      <CompleteLessonButton\n        :modelValue=\"isCompleted\"\n        @update:modelValue=\"toggleComplete\"\n      />\n    </ClientOnly>\n  </div>\n</template>\n\n<script setup>\nimport CompleteLessonButton from \"~/components/CompleteLessonButton.vue\";\nimport { useCourseProgress } from \"~/store/courseProgress\";\n\nconst store = useCourseProgress();\nconst { initialize, toggleComplete } = store;\n\nconst user = useSupabaseUser();\n\nconsole.log(user.value.email);\ninitialize();\n\ndefinePageMeta({\n  middleware: [\"auth\"],\n});\n\nconst course = await useCourse();\nconst { params } = useRoute();\nconst lesson = await useLesson(params.chapterSession, params.lessonSlug);\n\nconst currentChapter = computed(() => {\n  return course.value.data.chapters.find(\n    (element) => element.slug == params.chapterSession\n  );\n});\n\nconst currentLesson = computed(() => {\n  return currentChapter.value.lessons.find(\n    (element) => element.slug == params.lessonSlug\n  );\n});\n\nconst isCompleted = computed(() => {\n  return store.progress?.[params.chapterSession]?.[params.lessonSlug] || false;\n});\n\nuseHead({\n  title: `${currentLesson.value.title}`,\n});\n</script>\n"],"names":["user","_withAsyncContext"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,UAAM,QAAQ;;;;;;;;;;;;;;;;;;;;;ACCd,MAAe,qDAAgB;AAAA,EAC7B,MAAM;AAAA,EACN,cAAc;AAAA;AAAA,EAEd,OAAO,CAAC,YAAY,eAAe,kBAAkB,aAAa;AAAA,EAClE,MAAM,GAAG,EAAE,OAAO,MAAK,GAAI;AACzB,UAAM,UAAU,IAAI,KAAK;AAIzB,WAAO,CAAC,UAAU;;AAChB,UAAI,QAAQ,OAAO;AACjB,gBAAO,WAAM,YAAN;AAAA,MACR;AACD,YAAM,OAAO,MAAM,YAAY,MAAM;AACrC,UAAI,MAAM;AACR,eAAO,KAAI;AAAA,MACZ;AACD,YAAM,cAAc,MAAM,YAAY,MAAM,eAAe;AAC3D,YAAM,cAAc,MAAM,eAAe,MAAM,kBAAkB;AACjE,aAAO,mBAAmB,aAAa,OAAO,WAAW;AAAA,IAC/D;AAAA,EACG;AACH,CAAC;ACzBD,MAAA,YAAe,OAAO,aAAqB,eAAuB;AAChE,QAAM,MAAM,uBAAuB,WAAW,WAAW,UAAU;AAC5D,SAAA,MAAM,mBAAmB,GAAG;AACrC;ACDa,MAAA,oBAAoB,YAAY,kBAAkB,MAAM;AACtD,kBAAgB;AACvB,QAAA,WAAW,IAAS,CAAA,CAAE;AACtB,QAAA,cAAc,IAAI,KAAK;AAE7B,iBAAe,aAAa;AAC1B,QAAI,YAAY;AAAO;AACvB,gBAAY,QAAQ;AAAA,EACtB;AACM,QAAA,iBAAiB,OAAO,SAAiB,WAAmB;;AAChE,UAAMA,QAAO;AACb,QAAI,CAACA,MAAK;AAAO;AACb,QAAA,CAAC,WAAW,CAAC,QAAQ;AACjB,YAAA;AAAA,QACJ,QAAQ,EAAE,gBAAgB,WAAW;AAAA,UACnC,SAAS;AACH,gBAAA;AACD,eAAA;AAAA,IACX;AACA,UAAM,mBAAkB,cAAS,MAAM,OAAO,MAAtB,mBAA0B;AACzC,aAAA,MAAM,OAAO,IAAI;AAAA,MACxB,GAAG,SAAS,MAAM,OAAO;AAAA,MACzB,CAAC,MAAM,GAAG,CAAC;AAAA,IAAA;AAET,QAAA;AACF,YAAM,OAAO,uBAAuB,OAAO,WAAW,MAAM,aAAa;AAAA,QACvE,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,WAAW,CAAC;AAAA,UACZ,WAAWA,MAAK,MAAM;AAAA,QACxB;AAAA,MAAA,CACD;AAAA,aACM,OAAO;AACd,cAAQ,MAAM,KAAK;AACV,eAAA,MAAM,OAAO,IAAI;AAAA,QACxB,GAAG,SAAS,MAAM,OAAO;AAAA,QACzB,CAAC,MAAM,GAAG;AAAA,MAAA;AAAA,IAEd;AAAA,EAAA;AAGK,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ,CAAC;;;;;;ACzBD,UAAM,QAAQ,kBAAiB;AAC/B,UAAM,EAAE,YAAY,eAAgB,IAAG;AAEvC,UAAM,OAAO,gBAAe;AAE5B,YAAQ,IAAI,KAAK,MAAM,KAAK;AAC5B;AAMA,UAAM,UAAe,CAAA,QAAA,SAAA,IAAAC,iBAAA,MAAA,UAAS,CAAC;AAC/B,UAAM,EAAE,OAAM,IAAK;AACnB,UAAM,UAAe,CAAA,QAAA,SAAA,IAAAA,iBAAA,MAAA,UAAU,OAAO,gBAAgB,OAAO,UAAU,CAAA;AAEvE,UAAM,iBAAiB,SAAS,MAAM;AACpC,aAAO,OAAO,MAAM,KAAK,SAAS;AAAA,QAChC,CAAC,YAAY,QAAQ,QAAQ,OAAO;AAAA,MACxC;AAAA,IACA,CAAC;AAED,UAAM,gBAAgB,SAAS,MAAM;AACnC,aAAO,eAAe,MAAM,QAAQ;AAAA,QAClC,CAAC,YAAY,QAAQ,QAAQ,OAAO;AAAA,MACxC;AAAA,IACA,CAAC;AAEmB,aAAS,MAAM;;AACjC,eAAO,iBAAM,aAAN,mBAAiB,OAAO,oBAAxB,mBAA0C,OAAO,gBAAe;AAAA,IACzE,CAAC;AAED,YAAQ;AAAA,MACN,OAAO,GAAG,cAAc,MAAM,KAAK;AAAA,IACrC,CAAC;;;;;;;;;;;;;;;;;;;;","x_google_ignoreList":[1]}